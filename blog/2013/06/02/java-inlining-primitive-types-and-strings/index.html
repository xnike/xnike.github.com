<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Java: inlining primitive types and Strings</title>
  <meta name="author" content="Nikolay Khramchenkov">



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="/favicon.png" rel="icon">
  <link href="/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="/theme/js/modernizr-2.0.js"></script>
  <script src="/theme/js/ender.js"></script>
  <script src="/theme/js/octopress.js" type="text/javascript"></script>

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="/">xnike's blog</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>



<ul class="main-navigation">
    <li><a href="/">xnike's blog</a></li>
    <li><a href="archives.html">Archives</a></li>
      <li><a href="/pages/blackberry-world.html">Blackberry World</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Java: inlining primitive types and Strings</h1>
      <p class="meta"><time datetime="2013-06-02T17:47:00+04:00" pubdate>Sun 02 June 2013</time></p>
</header>

  <div class="entry-content"><p>At this moment, almost all IDEs and build systems can and actively use an increment build, i.e. recompile only changed files; so one time you could face the following issue: you change value of a constant in a one class, but get original value when use it in the another class.</p>
<p>Assume we have the piece of code in 2 class files correspondingly:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;A&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;A.s = &quot;</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="na">s</span> <span class="o">+</span> <span class="s">&quot;, A.i = &quot;</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="na">i</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>After compiling classes and running, we get output:</p>
<div class="highlight"><pre><span class="nv">$ </span>javac A.java <span class="o">&amp;&amp;</span> javac B.java <span class="o">&amp;&amp;</span> java B
A.s <span class="o">=</span> A, A.i <span class="o">=</span> 1
</pre></div>


<p>In case of changing constants in A, recompiling it (only A.java) and then running B, we will receive the previous result. It's because compiler goes through constants in the class and checks each member whether or not it is an expression possible to compute at the compile time or the run time. A constant with the compile time computable value is a target for inlining.</p>
<p>Let's edit the A class int the following way:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;A&quot;</span><span class="o">.</span><span class="na">intern</span><span class="o">();</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>


<p>And then recompile and run:</p>
<div class="highlight"><pre><span class="nv">$ </span>javac A.java <span class="o">&amp;&amp;</span> javac B.java <span class="o">&amp;&amp;</span> java B
A.s <span class="o">=</span> A, A.i <span class="o">=</span> 1
</pre></div>


<p>In case of changing constants in A and recompling only A, every running B we will receive correct constants values.
You can easily find what are the differencies in the bytecodes of the two versions of produced classes by using standart JDK utility javap.</p>
<p>For example, for the first version of A class we get:</p>
<div class="highlight"><pre><span class="nv">$ </span>javap -c A
Compiled from <span class="s2">&quot;A.java&quot;</span>
public class A <span class="o">{</span>
  public static final java.lang.String s;

  public static final int i;

  public A<span class="o">()</span>;
    Code:
       0: aload_0       
       1: invokespecial <span class="c">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
       4: <span class="k">return</span>        
<span class="o">}</span>
</pre></div>


<p>Welcome to the amazing modern Java World.</p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Nikolay Khramchenkov</span>
  </span>
<time datetime="2013-06-02T17:47:00+04:00" pubdate>Sun 02 June 2013</time>  <span class="categories">
    <a class="category" href="/tag/java.html">java</a>
  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="/blog/2014/12/06/momentics-ide-installing-on-a-headless-linux-system/">Momentics IDE: Installing on a headless Linux system.</a>
      </li>
      <li class="post">
          <a href="/blog/2014/09/07/blackberry-10-creating-unit-tests-for-js/">BlackBerry 10: Creating unit tests for JS.</a>
      </li>
      <li class="post">
          <a href="/blog/2013/11/18/xpcom-error-0x80004005/">XPCOM error 0x80004005</a>
      </li>
      <li class="post">
          <a href="/blog/2013/08/13/blackberry-10-changing-application-theme-in-runtime/">Blackberry 10: Changing application theme in runtime</a>
      </li>
      <li class="post">
          <a href="/blog/2013/06/02/java-inlining-primitive-types-and-strings/">Java: inlining primitive types and Strings</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="/category/misc.html">misc</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="/tag/x86_64.html">X86_64</a>,    <a href="/tag/bb10.html">BB10</a>,    <a href="/tag/marmalade.html">Marmalade</a>,    <a href="/tag/qml.html">QML</a>,    <a href="/tag/linux.html">Linux</a>,    <a href="/tag/cascades.html">Cascades</a>,    <a href="/tag/native.html">Native</a>,    <a href="/tag/java.html">java</a>,    <a href="/tag/fedora.html">FEDORA</a>,    <a href="/tag/poco.html">POCO</a>,    <a href="/tag/theme.html">Theme</a>,    <a href="/tag/qunit.html">QUnit</a>,    <a href="/tag/qnx.html">QNX</a>,    <a href="/tag/js.html">JS</a>,    <a href="/tag/windows-8.html">Windows 8</a>,    <a href="/tag/grunt.html">Grunt</a>,    <a href="/tag/c.html">C++</a>,    <a href="/tag/qt.html">Qt</a>,    <a href="/tag/bbndk.html">BBNDK</a>,    <a href="/tag/blackberry.html">Blackberry</a>,    <a href="/tag/momentics-ide.html">Momentics IDE</a>,    <a href="/tag/blackberry-10.html">Blackberry 10</a>,    <a href="/tag/playbook.html">Playbook</a>  </section>



</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2012-2014  - Nikolay Khramchenkov -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
</body>
</html>