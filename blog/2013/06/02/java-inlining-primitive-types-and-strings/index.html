<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Java: inlining primitive types and Strings &mdash; xnike's blog</title>
  <meta name="author" content="Nikolay Khramchenkov">

  <link href="http://xnike.me/feeds/all.atom.xml" type="application/rss+xml" rel="alternate"
        title="xnike's blog RSS Feed" />


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://xnike.me/favicon.png" rel="icon">

  <link href="http://xnike.me/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
        
  <script src="http://xnike.me/theme/js/angular.min.js" type="text/javascript"></script>
  <script src="http://xnike.me/theme/js/angular-sanitize.min.js" type="text/javascript"></script>
  <script src="http://xnike.me/theme/js/ui-bootstrap-tpls-0.12.0.min.js" type="text/javascript"></script>
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://xnike.me/">xnike's blog</a></h1>

  <div style="text-align:center">
  	<iframe frameborder="0" allowtransparency="true" scrolling="no" src="https://money.yandex.ru/embed/donate.xml?account=410011017961319&quickpay=donate&payment-type-choice=off&default-sum=50&targets=Qt+(BB10%2C+Sailfish+OS%2C+Ubuntu+Touch)+Application+Development&target-visibility=on&project-name=&project-site=&button-text=02&successURL=" width="490" height="104"></iframe>
  </div>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://xnike.me/feeds/all.atom.xml" rel="subscribe-rss">RSS</a></li>
</ul>


<form action="https://duckduckgo.com" method="get">
  <fieldset role="search">
    <input type="hidden" name="sites" value="xnike.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
    <li><a href="/">xnike's blog</a></li>
    <li><a href="archives.html">Archives</a></li>
      <li><a href="http://xnike.me/pages/blackberry-world-apps.html">BlackBerry World Apps</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
    
    <div id="qr-code-blog/2013/06/02/java-inlining-primitive-types-and-strings/" class="qr-code-image-block"></div>
    <script src="http://xnike.me/theme/js/qr.min.js" type="text/javascript"></script>
    <script>
        var img = qr.image({
            value: 'http://xnike.me/blog/2013/06/02/java-inlining-primitive-types-and-strings/',
            level: 'L',
            size: 4
        });
        document.getElementById('qr-code-blog/2013/06/02/java-inlining-primitive-types-and-strings/').appendChild(img);
    </script>
      <h1 class="entry-title">Java: inlining primitive types and Strings</h1>
    <p class="meta">
<time datetime="2013-06-02T17:47:00+04:00" pubdate>Sun 02 June 2013</time>    </p>
</header>

  <div class="entry-content"><p>At this moment, almost all IDEs and build systems can and actively use an increment build, i.e. recompile only changed files; so one time you could face the following issue: you change value of a constant in a one class, but get original value when use it in the another class.</p>
<p>Assume we have the piece of code in 2 class files correspondingly:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;A&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;A.s = &quot;</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="na">s</span> <span class="o">+</span> <span class="s">&quot;, A.i = &quot;</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="na">i</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>After compiling classes and running, we get output:</p>
<div class="highlight"><pre><span class="nv">$ </span>javac A.java <span class="o">&amp;&amp;</span> javac B.java <span class="o">&amp;&amp;</span> java B
A.s <span class="o">=</span> A, A.i <span class="o">=</span> 1
</pre></div>


<p>In case of changing constants in A, recompiling it (only A.java) and then running B, we will receive the previous result. It's because compiler goes through constants in the class and checks each member whether or not it is an expression possible to compute at the compile time or the run time. A constant with the compile time computable value is a target for inlining.</p>
<p>Let's edit the A class int the following way:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;A&quot;</span><span class="o">.</span><span class="na">intern</span><span class="o">();</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>


<p>And then recompile and run:</p>
<div class="highlight"><pre><span class="nv">$ </span>javac A.java <span class="o">&amp;&amp;</span> javac B.java <span class="o">&amp;&amp;</span> java B
A.s <span class="o">=</span> A, A.i <span class="o">=</span> 1
</pre></div>


<p>In case of changing constants in A and recompling only A, every running B we will receive correct constants values.
You can easily find what are the differencies in the bytecodes of the two versions of produced classes by using standart JDK utility javap.</p>
<p>For example, for the first version of A class we get:</p>
<div class="highlight"><pre><span class="nv">$ </span>javap -c A
Compiled from <span class="s2">&quot;A.java&quot;</span>
public class A <span class="o">{</span>
  public static final java.lang.String s;

  public static final int i;

  public A<span class="o">()</span>;
    Code:
       0: aload_0       
       1: invokespecial <span class="c">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
       4: <span class="k">return</span>        
<span class="o">}</span>
</pre></div>


<p>Welcome to the amazing modern Java World.</p></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Nikolay Khramchenkov
    </span>
  </span>
<time datetime="2013-06-02T17:47:00+04:00" pubdate>Sun 02 June 2013</time>  <span class="categories">
    <a class='category' href='http://xnike.me/category/misc.html'>misc</a>
  </span>
  <span class="categories">
    <a class="category" href="http://xnike.me/tag/java.html">java</a>  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://xnike.me/blog/2014/12/06/momentics-ide-installing-on-a-headless-linux-system/">Momentics IDE: Installing on a headless Linux system.</a>
      </li>
      <li class="post">
          <a href="http://xnike.me/blog/2014/09/07/blackberry-10-creating-unit-tests-for-js/">BlackBerry 10: Creating unit tests for JS.</a>
      </li>
      <li class="post">
          <a href="http://xnike.me/blog/2013/11/18/xpcom-error-0x80004005/">XPCOM error 0x80004005</a>
      </li>
      <li class="post">
          <a href="http://xnike.me/blog/2013/08/13/blackberry-10-changing-application-theme-in-runtime/">Blackberry 10: Changing application theme in runtime</a>
      </li>
      <li class="post">
          <a href="http://xnike.me/blog/2013/06/02/java-inlining-primitive-types-and-strings/">Java: inlining primitive types and Strings</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://xnike.me/category/misc.html">misc</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://xnike.me/tag/x86_64.html">X86_64</a>,    <a href="http://xnike.me/tag/bb10.html">BB10</a>,    <a href="http://xnike.me/tag/marmalade.html">Marmalade</a>,    <a href="http://xnike.me/tag/qml.html">QML</a>,    <a href="http://xnike.me/tag/linux.html">Linux</a>,    <a href="http://xnike.me/tag/cascades.html">Cascades</a>,    <a href="http://xnike.me/tag/native.html">Native</a>,    <a href="http://xnike.me/tag/java.html">java</a>,    <a href="http://xnike.me/tag/fedora.html">FEDORA</a>,    <a href="http://xnike.me/tag/poco.html">POCO</a>,    <a href="http://xnike.me/tag/theme.html">Theme</a>,    <a href="http://xnike.me/tag/qunit.html">QUnit</a>,    <a href="http://xnike.me/tag/qnx.html">QNX</a>,    <a href="http://xnike.me/tag/js.html">JS</a>,    <a href="http://xnike.me/tag/windows-8.html">Windows 8</a>,    <a href="http://xnike.me/tag/grunt.html">Grunt</a>,    <a href="http://xnike.me/tag/c.html">C++</a>,    <a href="http://xnike.me/tag/qt.html">Qt</a>,    <a href="http://xnike.me/tag/bbndk.html">BBNDK</a>,    <a href="http://xnike.me/tag/blackberry.html">Blackberry</a>,    <a href="http://xnike.me/tag/momentics-ide.html">Momentics IDE</a>,    <a href="http://xnike.me/tag/blackberry-10.html">Blackberry 10</a>,    <a href="http://xnike.me/tag/playbook.html">Playbook</a>  </section>



</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2012&ndash;2014  Nikolay Khramchenkov &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://xnike.me/theme/js/modernizr-2.0.js"></script>
  <script src="http://xnike.me/theme/js/ender.js"></script>
  <script src="http://xnike.me/theme/js/octopress.js" type="text/javascript"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34844836-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34844836-1');
    ga('send', 'pageview');
</script>
	<script type="text/javascript">
	  var disqus_shortname = 'xnikeme';
          var disqus_identifier = '/blog/2013/06/02/java-inlining-primitive-types-and-strings/';
          var disqus_url = 'http://xnike.me/blog/2013/06/02/java-inlining-primitive-types-and-strings/';
          var disqus_title = 'Java: inlining primitive types and Strings';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
</body>
</html>